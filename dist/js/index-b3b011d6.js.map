{"version":3,"file":"index-b3b011d6.js","sources":["../../src/app/storage/url.js","../../src/app/store/index.js"],"sourcesContent":["import { defaultState } from '../store/store';\nimport { truncate } from '../utils';\nimport { View } from '../navigation/reducer';\n// todo it is a rough serialization could be optimized as we shall know the data structure (to be check too we backward compatibility issues in case of structure changes)\nconst serializeData = (state) => btoa(JSON.stringify(project(state)));\nconst deserializeData = (encoded) => JSON.parse(atob(encoded));\nconst mergeStates = (...states) => {\n    const [init, ...rest] = states;\n    return rest.reduce((acc, curr) => {\n        acc.search = Object.assign({}, acc.search, curr.search);\n        acc.itinerary = Object.assign({}, acc.itinerary, curr.itinerary);\n        return acc;\n    }, init);\n};\nconst project = (state) => {\n    switch (state.navigation.selectedView) {\n        case View.ITINERARY:\n            return { itinerary: { stops: state.itinerary.stops } };\n        case View.SEARCH:\n            return { search: { selectedSearchResult: state.search.selectedSearchResult } };\n        case View.LEISURE:\n            return {};\n        default:\n            return {};\n    }\n};\nexport const serialize = (state) => {\n    const view = state.navigation.selectedView;\n    const location = [...state.map.center.map(v => truncate(v, 8)), `${state.map.zoom}z`].join((','));\n    const data = serializeData(state);\n    return new URL(`/${view.toLowerCase()}/@${location}/data=${data}`, window.location.origin);\n};\nconst viewRegexp = /^(settings|search|itinerary|leisure)/;\nconst locationRegexp = /^@.*z$/;\nconst dataRegexp = /^data=/;\nexport const deserialize = (url) => {\n    try {\n        const parts = url.pathname.split('/');\n        const view = parts.find(v => viewRegexp.test(v));\n        const location = parts.find(v => locationRegexp.test(v));\n        const data = parts.find(v => dataRegexp.test(v));\n        let state = defaultState();\n        if (view) {\n            state.navigation.selectedView = view.toUpperCase();\n        }\n        if (location) {\n            const [lng, lat, zoom] = location.slice(1).split(',');\n            state.map.center = [Number(lng), Number(lat)];\n            state.map.zoom = Number(zoom.slice(0, zoom.length - 1));\n        }\n        if (data) {\n            const decoded = deserializeData(data.slice(5));\n            state = mergeStates(state, decoded);\n        }\n        return state;\n    }\n    catch (e) {\n        console.log(e);\n        return defaultState();\n    }\n};\nexport const storage = (window) => {\n    return {\n        async get() {\n            return deserialize(window.location.href);\n        },\n        async set(state) {\n            const url = serialize(state);\n            if (url.href !== window.location.href) {\n                window.history.pushState(state, '', url.pathname);\n            }\n        }\n    };\n};\n","import { store } from './store';\nimport { deserialize } from '../storage/url';\nconst initialState = deserialize(new URL(window.location.href));\nexport default store()(initialState);\n"],"names":["store"],"mappings":";;;AAGA;AACA,MAAM,aAAa,GAAG,CAAC,KAAK,KAAK,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACtE,MAAM,eAAe,GAAG,CAAC,OAAO,KAAK,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;AAC/D,MAAM,WAAW,GAAG,CAAC,GAAG,MAAM,KAAK;IAC/B,MAAM,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC,GAAG,MAAM,CAAC;IAC/B,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,IAAI,KAAK;QAC9B,GAAG,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;QACxD,GAAG,CAAC,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;QACjE,OAAO,GAAG,CAAC;KACd,EAAE,IAAI,CAAC,CAAC;CACZ,CAAC;AACF,MAAM,OAAO,GAAG,CAAC,KAAK,KAAK;IACvB,QAAQ,KAAK,CAAC,UAAU,CAAC,YAAY;QACjC,KAAK,IAAI,CAAC,SAAS;YACf,OAAO,EAAE,SAAS,EAAE,EAAE,KAAK,EAAE,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE,EAAE,CAAC;QAC3D,KAAK,IAAI,CAAC,MAAM;YACZ,OAAO,EAAE,MAAM,EAAE,EAAE,oBAAoB,EAAE,KAAK,CAAC,MAAM,CAAC,oBAAoB,EAAE,EAAE,CAAC;QACnF,KAAK,IAAI,CAAC,OAAO;YACb,OAAO,EAAE,CAAC;QACd;YACI,OAAO,EAAE,CAAC;KACjB;CACJ,CAAC;AACF,AAAO,MAAM,SAAS,GAAG,CAAC,KAAK,KAAK;IAChC,MAAM,IAAI,GAAG,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC;IAC3C,MAAM,QAAQ,GAAG,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,GAAG,EAAE,CAAC;IAClG,MAAM,IAAI,GAAG,aAAa,CAAC,KAAK,CAAC,CAAC;IAClC,OAAO,IAAI,GAAG,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,EAAE,EAAE,QAAQ,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;CAC9F,CAAC;AACF,MAAM,UAAU,GAAG,sCAAsC,CAAC;AAC1D,MAAM,cAAc,GAAG,QAAQ,CAAC;AAChC,MAAM,UAAU,GAAG,QAAQ,CAAC;AAC5B,AAAO,MAAM,WAAW,GAAG,CAAC,GAAG,KAAK;IAChC,IAAI;QACA,MAAM,KAAK,GAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACtC,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QACjD,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QACzD,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QACjD,IAAI,KAAK,GAAG,YAAY,EAAE,CAAC;QAC3B,IAAI,IAAI,EAAE;YACN,KAAK,CAAC,UAAU,CAAC,YAAY,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;SACtD;QACD,IAAI,QAAQ,EAAE;YACV,MAAM,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YACtD,KAAK,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;YAC9C,KAAK,CAAC,GAAG,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;SAC3D;QACD,IAAI,IAAI,EAAE;YACN,MAAM,OAAO,GAAG,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YAC/C,KAAK,GAAG,WAAW,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;SACvC;QACD,OAAO,KAAK,CAAC;KAChB;IACD,OAAO,CAAC,EAAE;QACN,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QACf,OAAO,YAAY,EAAE,CAAC;KACzB;CACJ,CAAC;AACF,AAAY,MAAC,OAAO,GAAG,CAAC,MAAM,KAAK;IAC/B,OAAO;QACH,MAAM,GAAG,GAAG;YACR,OAAO,WAAW,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;SAC5C;QACD,MAAM,GAAG,CAAC,KAAK,EAAE;YACb,MAAM,GAAG,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC;YAC7B,IAAI,GAAG,CAAC,IAAI,KAAK,MAAM,CAAC,QAAQ,CAAC,IAAI,EAAE;gBACnC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,KAAK,EAAE,EAAE,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAC;aACrD;SACJ;KACJ,CAAC;CACL;;ACvED,MAAM,YAAY,GAAG,WAAW,CAAC,IAAI,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;AAChE,YAAeA,OAAK,EAAE,CAAC,YAAY,CAAC,CAAC;;;;"}