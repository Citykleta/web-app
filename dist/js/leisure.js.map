{"version":3,"file":"leisure.js","sources":["../../src/app/leisure/elements/leisure-panel.style.js","../../src/app/leisure/elements/leisure-panel.js","../../src/app/leisure/actions.js","../../src/app/leisure/service.js","../../src/app/leisure/module.js"],"sourcesContent":["import { css } from 'lit-element';\n// language=CSS\nexport const style = css `\n    :host {\n        background: var(--background-theme);\n        --route-bg-color: inherit;\n        --route-color: inherit;\n        --route-border-color: var(--background-theme-1);\n    }\n\n    :host > * {\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12),\n        0 4px 4px rgba(0, 0, 0, 0.12),\n        0 6px 4px rgba(0, 0, 0, 0.12);\n    }\n\n    ul {\n        list-style: none;\n        margin: 0;\n        padding: 0;\n        width: 100%;\n    }\n\n    li {\n        padding: 0.5em 1em;\n        background: var(--route-bg-color);\n        color: var(--route-color);\n        transition: background-color 0.3s, color 0.3s;\n    }\n\n    li[aria-selected=true] {\n        --route-bg-color: var(--color-theme-1);\n        --route-color: var(--font-color-theme-2);\n    }\n\n    li:not(:last-child) {\n        border-bottom: 1px solid var(--route-border-color);\n    }\n\n    h2 {\n        margin: 0;\n    }\n\n    p {\n        margin: 0.25em 0;\n    }\n`;\n","import { html, LitElement } from 'lit-element';\nimport { style } from './leisure-panel.style';\nimport { loadingIndicator } from '../../common/elements/icons';\nexport const template = ({ leisure, isSearching, routes, selectedRouteId }) => {\n    if (isSearching) {\n        return html `<div>${loadingIndicator()}</div>`;\n    }\n    else {\n        return html `<ul tabindex=\"0\">\n${routes.map(r => html `<li @click=${() => leisure.selectRoute(r.id)} aria-selected=\"${r.id === selectedRouteId}\"><article>\n<h2>${r.title}</h2>\n<p>${r.description}</p>\n</article></li>`)}\n</ul>`;\n    }\n};\nexport const propDef = {\n    isSearching: { type: Boolean },\n    routes: { type: Array },\n    selectedRouteId: { type: Number }\n};\n// todo refactor with equivalent Listbox\nexport class LeisurePanel extends LitElement {\n    constructor(serviceRegistry) {\n        super();\n        this.isSearching = false;\n        this.selectedRouteId = null;\n        this.routes = [];\n        this._leisure = null;\n        this._leisure = serviceRegistry.get('leisure');\n    }\n    static get styles() {\n        return style;\n    }\n    static get properties() {\n        return propDef;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this._leisure.searchRoutes();\n        this.addEventListener('keydown', this.handleKeyDown.bind(this));\n    }\n    render() {\n        return template({\n            leisure: this._leisure,\n            isSearching: this.isSearching,\n            selectedRouteId: this.selectedRouteId,\n            routes: this.routes\n        });\n    }\n    handleKeyDown(ev) {\n        const { key } = ev;\n        const routeLength = this.routes.length;\n        const currentIndex = this.routes.findIndex(r => r.id === this.selectedRouteId);\n        if (routeLength) {\n            let newRouteIndex = currentIndex > -1 ? currentIndex : 0;\n            switch (key) {\n                case 'ArrowDown': {\n                    newRouteIndex = (newRouteIndex + 1) % routeLength;\n                    break;\n                }\n                case 'ArrowUp': {\n                    newRouteIndex = (newRouteIndex - 1) >= 0 ? newRouteIndex - 1 : routeLength - 1;\n                    break;\n                }\n            }\n            this._leisure.selectRoute(this.routes[newRouteIndex].id);\n        }\n    }\n}\n","import { ActionType } from '../common/actions';\nexport const fetchLeisureRoutes = () => ({\n    type: ActionType.FETCH_LEISURE_ROUTES\n});\nexport const fetchLeisureRoutesWithFailure = (error) => ({\n    type: ActionType.FETCH_LEISURE_ROUTES_FAILURE,\n    error\n});\nexport const fetchLeisureRoutesWithSuccess = (result) => ({\n    type: ActionType.FETCH_LEISURE_ROUTES_SUCCESS,\n    result\n});\nexport const fetchLeisureRoutesFromAPI = () => async (dispatch, getState, API) => {\n    const { leisure } = API;\n    dispatch(fetchLeisureRoutes());\n    try {\n        const result = await leisure.searchRoutes();\n        dispatch(fetchLeisureRoutesWithSuccess(result));\n    }\n    catch (e) {\n        return dispatch(fetchLeisureRoutesWithFailure(e));\n    }\n};\nexport const selectLeisureRoute = (routeId) => ({\n    type: ActionType.SELECT_LEISURE_ROUTE,\n    routeId\n});\n","import { fetchLeisureRoutesFromAPI, selectLeisureRoute } from './actions';\nconst leisureActions = {\n    fetchLeisureRoutesFromAPI,\n    selectLeisureRoute\n};\nexport const provider = (store, { fetchLeisureRoutesFromAPI, selectLeisureRoute } = leisureActions) => {\n    return {\n        async searchRoutes() {\n            store.dispatch(fetchLeisureRoutesFromAPI());\n        },\n        selectRoute(id) {\n            store.dispatch(selectLeisureRoute(id));\n        }\n    };\n};\n","import { once } from '../utils';\nimport { LeisurePanel } from './elements/leisure-panel';\nimport { html } from 'lit-html';\nimport { reducer } from './reducer';\nimport { provider } from './service';\nimport { connect } from '../common/connect';\nimport store from '../store/index';\nexport * from './actions';\nexport * from './reducer';\nexport * from './service';\nexport { LeisurePanel } from './elements/leisure-panel';\nexport const loadServices = once((registry, store) => {\n    store.injectReducer('leisure', reducer);\n    registry.set('leisure', provider(store));\n});\nexport const loadComponents = once(injector => {\n    const connectedLeisurePanel = connect(store, (state) => state.leisure);\n    customElements.define('citykleta-leisure-panel', connectedLeisurePanel(injector(LeisurePanel)));\n});\nexport const view = () => html `<citykleta-leisure-panel class=\"panel\"></citykleta-leisure-panel>`;\n"],"names":[],"mappings":"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"}